# üìå–ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—é 6 (—ç–∫–∑–∞–º–µ–Ω)
## –¶–µ–ª–∏:
–ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–π DDS —Å–æ–≥–ª–∞—Å–Ω–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ data vault —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ Trino –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
## üîπ–ó–∞–¥–∞—á–∏:
1. –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö.
2. –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã dds –∏ —Ç–∞–±–ª–∏—Ü(—Ö–∞–±—ã,–ª–∏–Ω–∫–∏,—Å–∞—Ç–µ–ª–ª–∏—Ç—ã) –≤ –Ω–µ–π.
3. –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü —Å—Ö–µ–º—ã tiny –≤ —Ç–∞–±–ª–∏—Ü—ã –≤ —Å—Ö–µ–º–µ dds.
4. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–Ω—å,–ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä

### –ó–∞–ø—É—Å–∫–∞–µ–º trino –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –±–∞–∑–µ
–ó–∞–ø—É—Å–∫–∞–µ–º trino —á–µ—Ä–µ–∑ –¥–æ–∫–µ—Ä
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/1.png)
–ó–∞–ø—É—Å–∫–∞–µ–º –∫ –±–∞–∑–µ —á–µ—Ä–µ–∑ –±–æ–±—Ä–∞. –î–µ–ª–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/2.png)

### 1. –ê–Ω–∞–ª–∏–∑ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
–°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã –≤ —Å—Ö–µ–º–µ tiny 

![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/3.png)

C—Ö–µ–º–∞ –æ–ø–∏—Å–Ω–∞ [—Ç—É—Ç](https://www.tpc.org/TPC_Documents_Current_Versions/pdf/TPC-H_v3.0.1.pdf) 

![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/8.png)

#### –¢–∞–±–ª–∏—Ü–∞ CUSTOMER - –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ 
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/5.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/7.png)
- —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–±–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π.

#### –¢–∞–±–ª–∏—Ü–∞ SUPPLIER - –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ 
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/9.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/10.png)
- —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.

#### –¢–∞–±–ª–∏—Ü–∞ PART - —Ç–æ–≤–∞—Ä—ã
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/11.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/12.png)
- –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤

#### –¢–∞–±–ª–∏—Ü–∞ PARTSUPP - –ø–æ—Å—Ç–∞–≤—â–∏–∫‚Äì—Ç–æ–≤–∞—Ä
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/13.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/14.png)
- –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ—Å—Ç–∞–≤–∫–∏

#### –¢–∞–±–ª–∏—Ü–∞ ORDERS - –∑–∞–∫–∞–∑—ã
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/15.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/16.png)
- –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–∞–∫–∞–∑—ã. –í —Ñ–∞–π–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –Ω–µ —É –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã (—á–∞—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äú–º–µ—Ä—Ç–≤—ã–µ‚Äù –¥–ª—è join‚Äô–æ–≤) ‚Äî —ç—Ç–æ –∑–∞–ª–æ–∂–µ–Ω–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ.

#### –¢–∞–±–ª–∏—Ü–∞ LINEITEM - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/17.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/18.png)
- –≤ —Ç–∞–±–ª—Ü–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ 

#### –¢–∞–±–ª–∏—Ü–∞ NATION - —Å—Ç—Ä–∞–Ω—ã
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/19.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/20.png)
- –≤ —Ç–∞–±–ª—Ü–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—Ç—Ä–∞–Ω

#### –¢–∞–±–ª–∏—Ü–∞ REGION - REGION
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/21.png)
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/22.png)
- –≤ —Ç–∞–±–ª—Ü–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ REGION

–ï—Å–ª–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π, —Ç–æ —Å–≤—è–∑–∏ —Ç–∞–∫–∏–µ:
- CUSTOMER.C_NATIONKEY => NATION.N_NATIONKEY  Ôøº
- SUPPLIER.S_NATIONKEY => NATION.N_NATIONKEY  Ôøº
- NATION.N_REGIONKEY => REGION.R_REGIONKEY  Ôøº
- ORDERS.O_CUSTKEY => CUSTOMER.C_CUSTKEY  Ôøº
- PARTSUPP.PS_PARTKEY => PART.P_PARTKEY, PARTSUPP.PS_SUPPKEY => SUPPLIER.S_SUPPKEY  Ôøº
- LINEITEM.L_ORDERKEY => ORDERS.O_ORDERKEY, LINEITEM.L_PARTKEY => PART.P_PARTKEY, LINEITEM.L_SUPPKEY => SUPPLIER.S_SUPPKEY, (L_PARTKEY,L_SUPPKEY) => PARTSUPP 

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
–û–∑–Ω–∞–∫–æ–º–∏–≤—à–∏—Å—å —Å –¥–∞–Ω–Ω—ã–º–∏ –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î.

#### –ë–∏–∑–Ω–µ—Å‚Äë—Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∫–ª—é—á–∏
–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ–º–µ–Ω—ã (–∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü TPC-H)

__–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏/–º–∞—Å—Ç–µ—Ä–∞__:
- –ö–ª–∏–µ–Ω—Ç—ã: CUSTOMER
- –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏: SUPPLIER
- –¢–æ–≤–∞—Ä—ã: PART
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—è: REGION, NATION (–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∏—Ö –∏–∑ customer/supplier)
- –ó–∞–∫–∞–∑—ã (—à–∞–ø–∫–∞): ORDERS
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞: LINEITEM
- –°–≤—è–∑—å —Ç–æ–≤–∞—Ä‚Äì–ø–æ—Å—Ç–∞–≤—â–∏–∫ + –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ—Å—Ç–∞–≤–∫–∏: PARTSUPP

#### –§–∞–∫—Ç—ã/–º–µ—Ç—Ä–∏–∫–∏ (—á–∏—Å–ª–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏):
- –ü–æ –∑–∞–∫–∞–∑—É: O_TOTALPRICE
- –ü–æ –ø–æ–∑–∏—Ü–∏–∏: L_QUANTITY, L_EXTENDEDPRICE, L_DISCOUNT, L_TAX
  
__–í—ã–±–æ—Ä —Ö–∞–±–æ–≤ (Hubs)__

##### HUB_CUSTOMER
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: C_CUSTKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: –∫–ª–∏–µ–Ω—Ç ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Å—É—â–Ω–æ—Å—Ç—å.

##### HUB_SUPPLIER
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: S_SUPPKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: –ø–æ—Å—Ç–∞–≤—â–∏–∫ ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Å—É—â–Ω–æ—Å—Ç—å.

##### HUB_PART
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: P_PARTKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: —Ç–æ–≤–∞—Ä/–¥–µ—Ç–∞–ª—å ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Å—É—â–Ω–æ—Å—Ç—å.

##### HUB_ORDER
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: O_ORDERKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: –∑–∞–∫–∞–∑ ‚Äî —Å—É—â–Ω–æ—Å—Ç—å ‚Äú—à–∞–ø–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞‚Äù.

##### HUB_LINEITEM
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á (—Å–æ—Å—Ç–∞–≤–Ω–æ–π): L_ORDERKEY | L_LINENUMBER
- –ü–æ—á–µ–º—É —Ö–∞–±: –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫–∞–∑–∞ ‚Äî ‚Äú—Å—Ç—Ä–æ–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞‚Äù (—á–∞—Å—Ç–æ –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ —É —Å—Ç—Ä–æ–∫–∏ –º–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –¥–∞—Ç).

##### HUB_NATION
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: N_NATIONKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: —Å—Ç—Ä–∞–Ω–∞ ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫.

##### HUB_REGION
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á: R_REGIONKEY
- –ü–æ—á–µ–º—É —Ö–∞–±: —Ä–µ–≥–∏–æ–Ω - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫.

–ü—Ä–æ PARTSUPP: –µ–≥–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∫–∞–∫ HUB, –Ω–æ —á–∞—â–µ –∏ —á–∏—â–µ –≤ DV: link PART‚ÜîSUPPLIER + satellite –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–æ—Å—Ç–∞–≤–∫–∏


#### –õ–∏–Ω–∫–∏ (Links)

##### LNK_ORDER_CUSTOMER
- –°–≤—è–∑—å: ORDER <=> CUSTOMER (–∏–∑ ORDERS.O_CUSTKEY)
- –ë–∏–∑–Ω–µ—Å-—Å–æ—Å—Ç–∞–≤ –∫–ª—é—á–∞ –ª–∏–Ω–∫–∞: —Ö—ç—à –æ—Ç BK –∑–∞–∫–∞–∑–∞ –∏ BK –∫–ª–∏–µ–Ω—Ç–∞
- –°–º—ã—Å–ª: —Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Äú–∑–∞–∫–∞–∑ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–ª–∏–µ–Ω—Ç—É‚Äù.

##### LNK_LINEITEM_ORDER
- –°–≤—è–∑—å: LINEITEM <=> ORDER (–∏–∑ LINEITEM.L_ORDERKEY)
- –°–º—ã—Å–ª: —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∑–∞–∫–∞–∑—É.

##### LNK_LINEITEM_PART
- –°–≤—è–∑—å: LINEITEM <=> PART (–∏–∑ LINEITEM.L_PARTKEY)
- –°–º—ã—Å–ª: —Å—Ç—Ä–æ–∫–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–≤–∞—Ä.

##### LNK_LINEITEM_SUPPLIER
- –°–≤—è–∑—å: LINEITEM <=> SUPPLIER (–∏–∑ LINEITEM.L_SUPPKEY)
- –°–º—ã—Å–ª: —Å—Ç—Ä–æ–∫–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.

##### LNK_CUSTOMER_NATION
- –°–≤—è–∑—å: CUSTOMER <=> NATION (–∏–∑ CUSTOMER.C_NATIONKEY)
- –°–º—ã—Å–ª: –≥–µ–æ–ø—Ä–∏–≤—è–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞.

##### LNK_SUPPLIER_NATION
- –°–≤—è–∑—å: SUPPLIER <=> NATION (–∏–∑ SUPPLIER.S_NATIONKEY)
- –°–º—ã—Å–ª: –≥–µ–æ–ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.

##### LNK_NATION_REGION
- –°–≤—è–∑—å: NATION <=> REGION (–∏–∑ NATION.N_REGIONKEY)
- –°–º—ã—Å–ª: –∏–µ—Ä–∞—Ä—Ö–∏—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏.

##### LNK_PART_SUPPLIER
- –°–≤—è–∑—å: PART <=> SUPPLIER (–∏—Å—Ç–æ—á–Ω–∏–∫: PARTSUPP(PS_PARTKEY, PS_SUPPKEY))
- –°–º—ã—Å–ª: —ç—Ç–æ M:N —Å–≤—è–∑—å ‚Äú–ø–æ—Å—Ç–∞–≤—â–∏–∫ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä‚Äù.

#### –°–∞—Ç–µ–ª–ª–∏—Ç—ã (Satellites)

##### SAT_CUSTOMER_ATTR (–∫ HUB_CUSTOMER)
- –ê—Ç—Ä–∏–±—É—Ç—ã: C_NAME, C_ADDRESS, C_PHONE, C_ACCTBAL, C_MKTSEGMENT, C_COMMENT
- (NATIONKEY –ª—É—á—à–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —Ç—É—Ç –∫–∞–∫ –∞—Ç—Ä–∏–±—É—Ç, –∞ —Å–≤—è–∑—å—é —á–µ—Ä–µ–∑ LNK_CUSTOMER_NATION)

##### SAT_SUPPLIER_ATTR (–∫ HUB_SUPPLIER)
- –ê—Ç—Ä–∏–±—É—Ç—ã: S_NAME, S_ADDRESS, S_PHONE, S_ACCTBAL, S_COMMENT

##### SAT_PART_ATTR (–∫ HUB_PART)
- –ê—Ç—Ä–∏–±—É—Ç—ã: P_NAME, P_MFGR, P_BRAND, P_TYPE, P_SIZE, P_CONTAINER, P_RETAILPRICE, P_COMMENT

##### SAT_ORDER_ATTR (–∫ HUB_ORDER)
- –ê—Ç—Ä–∏–±—É—Ç—ã: O_ORDERSTATUS, O_TOTALPRICE, O_ORDERDATE, O_ORDERPRIORITY, O_CLERK, O_SHIPPRIORITY, O_COMMENT
- –¢—É—Ç –∂–µ –æ–±—ã—á–Ω–æ —É–¥–æ–±–Ω–æ –¥–µ—Ä–∂–∞—Ç—å O_ORDERDATE –∫–∞–∫ ‚Äú–±–∏–∑–Ω–µ—Å-–¥–∞—Ç—É‚Äù –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

##### SAT_LINEITEM_ATTR (–∫ HUB_LINEITEM)
- –ê—Ç—Ä–∏–±—É—Ç—ã: L_QUANTITY, L_EXTENDEDPRICE, L_DISCOUNT, L_TAX, L_RETURNFLAG, L_LINESTATUS, L_SHIPDATE, L_COMMITDATE, L_RECEIPTDATE, L_SHIPINSTRUCT, L_SHIPMODE, L_COMMENT

##### SAT_NATION_ATTR (–∫ HUB_NATION)
- –ê—Ç—Ä–∏–±—É—Ç—ã: N_NAME, N_COMMENT

##### SAT_REGION_ATTR (–∫ HUB_REGION)
- –ê—Ç—Ä–∏–±—É—Ç—ã: R_NAME, R_COMMENT

##### SAT_PART_SUPPLIER_ATTR (–∫ LNK_PART_SUPPLIER)
- –ê—Ç—Ä–∏–±—É—Ç—ã —Å–≤—è–∑–∏ –ø–æ—Å—Ç–∞–≤–∫–∏: PS_AVAILQTY, PS_SUPPLYCOST, PS_COMMENT
- –≠—Ç–æ –ø—Ä—è–º–æ–π –∞–Ω–∞–ª–æ–≥ —Ç–≤–æ–µ–≥–æ SAT_SALE_METRICS, —Ç–æ–ª—å–∫–æ –¥–ª—è ‚Äú—Å–≤—è–∑–∏ –ø–æ—Å—Ç–∞–≤–∫–∏‚Äù.

#### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ 
__Hash-keys (hub/link)__
- *_hk = md5(to_utf8(upper(trim(concat_ws('|', ...)))))

##### –ü—Ä–∏–º–µ—Ä—ã –±–∏–∑–Ω–µ—Å-—Å–æ—Å—Ç–∞–≤–∞:
- customer_hk = md5( to_utf8(upper(trim(cast(C_CUSTKEY as varchar))) ))
- link_order_customer_hk = md5( to_utf8(upper(trim(concat_ws('|', O_ORDERKEY, C_CUSTKEY)))) )
- lineitem_hk = md5( to_utf8(upper(trim(concat_ws('|', L_ORDERKEY, L_LINENUMBER)))) )

##### Hashdiff –≤ —Å–∞—Ç–µ–ª–ª–∏—Ç–∞—Ö
- hashdiff = md5(upper(to_utf8(trim(concat_ws('|', <–≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤–µ—Ä—Å–∏–∏> )))))
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ SCD2.

##### SCD2 –≤–æ –≤—Å–µ—Ö SAT
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∫–∞–∂–¥–æ–º SAT:
| –ü–æ–ª–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ  |
|--------------|--------------|
| start_date  | –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ä—Å–∏–∏ |
| end_date | –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ä—Å–∏–∏ |
| is_current | —Ñ–ª–∞–≥ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ |
| hashdiff | —Ö—ç—à –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| navi_date | —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–∞–Ω–∞–ª–æ–≥ load_dts) |
| record_source | –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö |

__–û—Ç–∫—Ä—ã—Ç–∞—è –≤–µ—Ä—Å–∏—è__
- end_date = DATE '9999-12-31'
- is_current = true

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º —Å—Ö–µ–º—É dds
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/4.png)

__–°–æ–∑–¥–∞—ë–º —Ö–∞–±—ã__
``` sql
CREATE TABLE IF NOT EXISTS memory.dds.hub_customer (
  customer_hk     VARBINARY,
  customer_bk     VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_supplier (
  supplier_hk     VARBINARY,
  supplier_bk     VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_part (
  part_hk         VARBINARY,
  part_bk         VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_order (
  order_hk        VARBINARY,
  order_bk        VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_lineitem (
  lineitem_hk     VARBINARY,
  lineitem_bk     VARCHAR,   -- ORDERKEY|LINENUMBER
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_nation (
  nation_hk       VARBINARY,
  nation_bk       VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.hub_region (
  region_hk       VARBINARY,
  region_bk       VARCHAR,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);
```

__–°–æ–∑–¥–∞—ë–º –ª–∏–Ω–∫–∏__
```sql
CREATE TABLE IF NOT EXISTS memory.dds.lnk_order_customer (
  lnk_hk          VARBINARY,
  order_hk        VARBINARY,
  customer_hk     VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_lineitem_order (
  lnk_hk          VARBINARY,
  lineitem_hk     VARBINARY,
  order_hk        VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_lineitem_part (
  lnk_hk          VARBINARY,
  lineitem_hk     VARBINARY,
  part_hk         VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_lineitem_supplier (
  lnk_hk          VARBINARY,
  lineitem_hk     VARBINARY,
  supplier_hk     VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_customer_nation (
  lnk_hk          VARBINARY,
  customer_hk     VARBINARY,
  nation_hk       VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_supplier_nation (
  lnk_hk          VARBINARY,
  supplier_hk     VARBINARY,
  nation_hk       VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_nation_region (
  lnk_hk          VARBINARY,
  nation_hk       VARBINARY,
  region_hk       VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.lnk_part_supplier (
  lnk_hk          VARBINARY,
  part_hk         VARBINARY,
  supplier_hk     VARBINARY,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);
```

__–°–æ–∑–¥–∞—ë–º —Å–∞—Ç—Ç–µ–ª–∏—Ç—ã__
```sql
CREATE TABLE IF NOT EXISTS memory.dds.sat_customer_attr (
  customer_hk     VARBINARY,
  c_name          VARCHAR,
  c_address       VARCHAR,
  c_phone         VARCHAR,
  c_acctbal       DOUBLE,
  c_mktsegment    VARCHAR,
  c_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_supplier_attr (
  supplier_hk     VARBINARY,
  s_name          VARCHAR,
  s_address       VARCHAR,
  s_phone         VARCHAR,
  s_acctbal       DOUBLE,
  s_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_part_attr (
  part_hk         VARBINARY,
  p_name          VARCHAR,
  p_mfgr          VARCHAR,
  p_brand         VARCHAR,
  p_type          VARCHAR,
  p_size          INTEGER,
  p_container     VARCHAR,
  p_retailprice   DOUBLE,
  p_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_order_attr (
  order_hk        VARBINARY,
  o_orderstatus   VARCHAR,
  o_totalprice    DOUBLE,
  o_orderdate     DATE,
  o_orderpriority VARCHAR,
  o_clerk         VARCHAR,
  o_shippriority  INTEGER,
  o_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_lineitem_attr (
  lineitem_hk     VARBINARY,
  l_quantity      DOUBLE,
  l_extendedprice DOUBLE,
  l_discount      DOUBLE,
  l_tax           DOUBLE,
  l_returnflag    VARCHAR,
  l_linestatus    VARCHAR,
  l_shipdate      DATE,
  l_commitdate    DATE,
  l_receiptdate   DATE,
  l_shipinstruct  VARCHAR,
  l_shipmode      VARCHAR,
  l_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_nation_attr (
  nation_hk       VARBINARY,
  n_name          VARCHAR,
  n_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_region_attr (
  region_hk       VARBINARY,
  r_name          VARCHAR,
  r_comment       VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);

CREATE TABLE IF NOT EXISTS memory.dds.sat_part_supplier_attr (
  lnk_hk          VARBINARY,  -- satellite of LNK_PART_SUPPLIER
  ps_availqty     INTEGER,
  ps_supplycost   DOUBLE,
  ps_comment      VARCHAR,
  hashdiff        VARBINARY,
  start_date      DATE,
  end_date        DATE,
  is_current      BOOLEAN,
  navi_date       TIMESTAMP,
  record_source   VARCHAR
);
```

–î–∞–ª–µ–µ –Ω–∞–ø–æ–ª–Ω–∏–º –∏—Ö –¥–∞–Ω–Ω—ã–º–∏ 

__–ó–∞–ø–æ–ª–Ω—è–µ–º —Ö–∞–±—ã__
```sql
INSERT INTO memory.dds.hub_customer
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(custkey as varchar)))))   AS customer_hk,
  upper(trim(cast(custkey as varchar)))                 AS customer_bk,
  current_timestamp                                     AS navi_date,
  'tpch.tiny.customer'                                  AS record_source
FROM tpch.tiny.customer;

INSERT INTO memory.dds.hub_supplier
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(suppkey as varchar)))))   AS supplier_hk,
  upper(trim(cast(suppkey as varchar)))                 AS supplier_bk,
  current_timestamp,
  'tpch.tiny.supplier'
FROM tpch.tiny.supplier;

INSERT INTO memory.dds.hub_part
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(partkey as varchar)))))   AS part_hk,
  upper(trim(cast(partkey as varchar)))                 AS part_bk,
  current_timestamp,
  'tpch.tiny.part'
FROM tpch.tiny.part;

INSERT INTO memory.dds.hub_order
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(orderkey as varchar)))))   AS order_hk,
  upper(trim(cast(orderkey as varchar)))                                      AS order_bk,
  current_timestamp,
  'tpch.tiny.orders'
FROM tpch.tiny.orders;

INSERT INTO memory.dds.hub_lineitem
SELECT DISTINCT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(orderkey as varchar),
      cast(linenumber as varchar)
  )))))                                                                        AS lineitem_hk,
  upper(trim(concat_ws('|',
      cast(orderkey as varchar),
      cast(linenumber as varchar)
  )))                                                                         AS lineitem_bk,
  current_timestamp,
  'tpch.tiny.lineitem'
FROM tpch.tiny.lineitem;

INSERT INTO memory.dds.hub_nation
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(nationkey as varchar)))))                                AS nation_hk,
  upper(trim(cast(nationkey as varchar)))                                     AS nation_bk,
  current_timestamp,
  'tpch.tiny.nation'
FROM tpch.tiny.nation;

INSERT INTO memory.dds.hub_region
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(regionkey as varchar)))))                                AS region_hk,
  upper(trim(cast(regionkey as varchar)))                                     AS region_bk,
  current_timestamp,
  'tpch.tiny.region'
FROM tpch.tiny.region;
```
__–ó–∞–ø–æ–ª–Ω—è–µ–º –ª–∏–Ω–∫–∏__

```sql
INSERT INTO memory.dds.hub_customer
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(custkey as varchar)))))   AS customer_hk,
  upper(trim(cast(custkey as varchar)))                 AS customer_bk,
  current_timestamp                                     AS navi_date,
  'tpch.tiny.customer'                                  AS record_source
FROM tpch.tiny.customer;

INSERT INTO memory.dds.lnk_order_customer
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(o.orderkey as varchar),
      cast(o.custkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(o.orderkey as varchar)))))                               AS order_hk,
  md5(to_utf8(upper(trim(cast(o.custkey as varchar)))))                                AS customer_hk,
  current_timestamp                                                           AS navi_date,
  'tpch.tiny.orders'                                                          AS record_source
FROM tpch.tiny.orders o;

INSERT INTO memory.dds.lnk_lineitem_order
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(l.orderkey as varchar),
      cast(l.linenumber as varchar),
      cast(l.orderkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(concat_ws('|', cast(l.orderkey as varchar), cast(l.linenumber as varchar)))))) AS lineitem_hk,
  md5(to_utf8(upper(trim(cast(l.orderkey as varchar)))))                               AS order_hk,
  current_timestamp,
  'tpch.tiny.lineitem'
FROM tpch.tiny.lineitem l;

INSERT INTO memory.dds.lnk_lineitem_part
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(l.orderkey as varchar),
      cast(l.linenumber as varchar),
      cast(l.partkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(concat_ws('|', cast(l.orderkey as varchar), cast(l.linenumber as varchar)))))) AS lineitem_hk,
  md5(to_utf8(upper(trim(cast(l.partkey as varchar)))))                                AS part_hk,
  current_timestamp,
  'tpch.tiny.lineitem'
FROM tpch.tiny.lineitem l;

INSERT INTO memory.dds.lnk_lineitem_supplier
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(l.orderkey as varchar),
      cast(l.linenumber as varchar),
      cast(l.suppkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(concat_ws('|', cast(l.orderkey as varchar), cast(l.linenumber as varchar)))))) AS lineitem_hk,
  md5(to_utf8(upper(trim(cast(l.suppkey as varchar)))))                                AS supplier_hk,
  current_timestamp,
  'tpch.tiny.lineitem'
FROM tpch.tiny.lineitem l;

INSERT INTO memory.dds.lnk_customer_nation
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(c.custkey as varchar),
      cast(c.nationkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(c.custkey as varchar)))))                                AS customer_hk,
  md5(to_utf8(upper(trim(cast(c.nationkey as varchar)))))                              AS nation_hk,
  current_timestamp,
  'tpch.tiny.customer'
FROM tpch.tiny.customer c;

INSERT INTO memory.dds.lnk_supplier_nation
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(s.suppkey as varchar),
      cast(s.nationkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(s.suppkey as varchar)))))                                AS supplier_hk,
  md5(to_utf8(upper(trim(cast(s.nationkey as varchar)))))                              AS nation_hk,
  current_timestamp,
  'tpch.tiny.supplier'
FROM tpch.tiny.supplier s;

INSERT INTO memory.dds.lnk_nation_region
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(n.nationkey as varchar),
      cast(n.regionkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(n.nationkey as varchar)))))                              AS nation_hk,
  md5(to_utf8(upper(trim(cast(n.regionkey as varchar)))))                              AS region_hk,
  current_timestamp,
  'tpch.tiny.nation'
FROM tpch.tiny.nation n;

INSERT INTO memory.dds.lnk_part_supplier
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(ps.partkey as varchar),
      cast(ps.suppkey as varchar)
  )))))                                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(ps.partkey as varchar)))))                               AS part_hk,
  md5(to_utf8(upper(trim(cast(ps.suppkey as varchar)))))                               AS supplier_hk,
  current_timestamp,
  'tpch.tiny.partsupp'
FROM tpch.tiny.partsupp ps;
```

__–ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∞—Ç–µ–ª–∏—Ç—ã__

```sql
INSERT INTO memory.dds.hub_customer
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(custkey as varchar)))))   AS customer_hk,
  upper(trim(cast(custkey as varchar)))                 AS customer_bk,
  current_timestamp                                     AS navi_date,
  'tpch.tiny.customer'                                  AS record_source
FROM tpch.tiny.customer;

INSERT INTO memory.dds.sat_customer_attr
SELECT
  md5(to_utf8(upper(trim(cast(c.custkey as varchar))))) AS customer_hk,
  c.name, c.address, c.phone, c.acctbal, c.mktsegment, c.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(c.name,''),
      coalesce(c.address,''),
      coalesce(c.phone,''),
      cast(coalesce(c.acctbal, 0.0) as varchar),
      coalesce(c.mktsegment,''),
      coalesce(c.comment,'')
  ))))) AS hashdiff,
  current_date AS start_date,
  DATE '9999-12-31' AS end_date,
  true AS is_current,
  current_timestamp AS navi_date,
  'tpch.tiny.customer' AS record_source
FROM tpch.tiny.customer c;

INSERT INTO memory.dds.sat_supplier_attr
SELECT
  md5(to_utf8(upper(trim(cast(s.suppkey as varchar))))) AS supplier_hk,
  s.name, s.address, s.phone, s.acctbal, s.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(s.name,''),
      coalesce(s.address,''),
      coalesce(s.phone,''),
      cast(coalesce(s.acctbal, 0.0) as varchar),
      coalesce(s.comment,'')
  ))))) AS hashdiff,
  current_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.supplier'
FROM tpch.tiny.supplier s;

INSERT INTO memory.dds.sat_part_attr
SELECT
  md5(to_utf8(upper(trim(cast(p.partkey as varchar))))) AS part_hk,
  p.name, p.mfgr, p.brand, p.type, p.size, p.container, p.retailprice, p.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(p.name,''),
      coalesce(p.mfgr,''),
      coalesce(p.brand,''),
      coalesce(p.type,''),
      cast(coalesce(p.size, 0) as varchar),
      coalesce(p.container,''),
      cast(coalesce(p.retailprice, 0.0) as varchar),
      coalesce(p.comment,'')
  ))))) AS hashdiff,
  current_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.part'
FROM tpch.tiny.part p;

INSERT INTO memory.dds.sat_order_attr
SELECT
  md5(to_utf8(upper(trim(cast(o.orderkey as varchar))))) AS order_hk,
  o.orderstatus, o.totalprice, o.orderdate, o.orderpriority, o.clerk, o.shippriority, o.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(o.orderstatus,''),
      cast(coalesce(o.totalprice, 0.0) as varchar),
      cast(o.orderdate as varchar),
      coalesce(o.orderpriority,''),
      coalesce(o.clerk,''),
      cast(coalesce(o.shippriority, 0) as varchar),
      coalesce(o.comment,'')
  ))))) AS hashdiff,
  o.orderdate AS start_date,
  DATE '9999-12-31' AS end_date,
  true AS is_current,
  current_timestamp AS navi_date,
  'tpch.tiny.orders' AS record_source
FROM tpch.tiny.orders o;

INSERT INTO memory.dds.sat_lineitem_attr
SELECT
  md5(to_utf8(upper(trim(concat_ws('|', cast(l.orderkey as varchar), cast(l.linenumber as varchar)))))) AS lineitem_hk,
  l.quantity, l.extendedprice, l.discount, l.tax, l.returnflag, l.linestatus,
  l.shipdate, l.commitdate, l.receiptdate, l.shipinstruct, l.shipmode, l.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(coalesce(l.quantity, 0.0) as varchar),
      cast(coalesce(l.extendedprice, 0.0) as varchar),
      cast(coalesce(l.discount, 0.0) as varchar),
      cast(coalesce(l.tax, 0.0) as varchar),
      coalesce(l.returnflag,''),
      coalesce(l.linestatus,''),
      cast(l.shipdate as varchar),
      cast(l.commitdate as varchar),
      cast(l.receiptdate as varchar),
      coalesce(l.shipinstruct,''),
      coalesce(l.shipmode,''),
      coalesce(l.comment,'')
  ))))) AS hashdiff,
  l.shipdate AS start_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.lineitem'
FROM tpch.tiny.lineitem l;

INSERT INTO memory.dds.sat_nation_attr
SELECT
  md5(to_utf8(upper(trim(cast(n.nationkey as varchar))))) AS nation_hk,
  n.name, n.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(n.name,''),
      coalesce(n.comment,'')
  ))))) AS hashdiff,
  current_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.nation'
FROM tpch.tiny.nation n;

INSERT INTO memory.dds.sat_region_attr
SELECT
  md5(to_utf8(upper(trim(cast(r.regionkey as varchar))))) AS region_hk,
  r.name, r.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(r.name,''),
      coalesce(r.comment,'')
  ))))) AS hashdiff,
  current_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.region'
FROM tpch.tiny.region r;

INSERT INTO memory.dds.sat_part_supplier_attr
SELECT
  md5(to_utf8(upper(trim(concat_ws('|', cast(ps.partkey as varchar), cast(ps.suppkey as varchar)))))) AS lnk_hk,
  ps.availqty, ps.supplycost, ps.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(coalesce(ps.availqty, 0) as varchar),
      cast(coalesce(ps.supplycost, 0.0) as varchar),
      coalesce(ps.comment,'')
  ))))) AS hashdiff,
  current_date,
  DATE '9999-12-31',
  true,
  current_timestamp,
  'tpch.tiny.partsupp'
FROM tpch.tiny.partsupp ps;
```

#### C–æ–∑–¥–∞–¥–∏–º —Ä—è–¥ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

1.  –ö–æ–Ω—Ç—Ä–æ–ª—å –æ–±—ä—ë–º–æ–≤: —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤ hubs/links/sats
```sql
SELECT 'hub_customer' AS obj, count(*) cnt FROM memory.dds.hub_customer
UNION ALL SELECT 'hub_orders', count(*) FROM memory.dds.hub_order
UNION ALL SELECT 'hub_lineitem', count(*) FROM memory.dds.hub_lineitem
UNION ALL SELECT 'lnk_order_customer', count(*) FROM memory.dds.lnk_order_customer
UNION ALL SELECT 'sat_order_attr', count(*) FROM memory.dds.sat_order_attr
UNION ALL SELECT 'sat_lineitem_attr', count(*) FROM memory.dds.sat_lineitem_attr;
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/23.png)

2. –¢–æ–ø-10 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Å—É–º–º–µ –∑–∞–∫–∞–∑–æ–≤ (—á–µ—Ä–µ–∑ link + sat)
```sql
SELECT
  hc.customer_bk,
  sc.c_name,
  round(sum(so.o_totalprice),2) AS total_price
FROM memory.dds.lnk_order_customer loc
JOIN memory.dds.hub_customer hc
  ON hc.customer_hk = loc.customer_hk
JOIN memory.dds.hub_order ho
  ON ho.order_hk = loc.order_hk
JOIN memory.dds.sat_customer_attr sc
  ON sc.customer_hk = hc.customer_hk AND sc.is_current
JOIN memory.dds.sat_order_attr so
  ON so.order_hk = ho.order_hk AND so.is_current
GROUP BY 1,2
ORDER BY total_price DESC
LIMIT 10;
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/24.png)

3. –í—ã—Ä—É—á–∫–∞ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º (–ø–æ –ø–æ–∑–∏—Ü–∏—è–º: extendedprice*(1-discount))

```sql
SELECT
  hs.supplier_bk,
  ss.s_name,
  round(sum(sl.l_extendedprice * (1 - sl.l_discount)),2) AS revenue
FROM memory.dds.lnk_lineitem_supplier lis
JOIN memory.dds.hub_supplier hs
  ON hs.supplier_hk = lis.supplier_hk
JOIN memory.dds.sat_supplier_attr ss
  ON ss.supplier_hk = hs.supplier_hk AND ss.is_current
JOIN memory.dds.sat_lineitem_attr sl
  ON sl.lineitem_hk = lis.lineitem_hk AND sl.is_current
GROUP BY 1,2
ORDER BY revenue DESC
LIMIT 10;
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/25.png)

4. –ó–∞–∫–∞–∑—ã –ø–æ –¥–Ω—è–º (–ø—Ä–æ–≤–µ—Ä–∫–∞ orderdate –∫–∞–∫ start_date)
```sql
SELECT
  so.o_orderdate,
  count(*) AS orders_cnt,
  round(sum(so.o_totalprice),2) AS total_price
FROM memory.dds.sat_order_attr so
WHERE so.is_current
GROUP BY 1
ORDER BY 1 desc
limit 10;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/26.png)

### 4. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–Ω—å,–ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä

–ú—ã —Å–¥–µ–ª–∞–ª–∏ —Ä–∞–Ω–µ–µ –ø–æ–ª–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö. –°–µ–π—á–∞—Å –±—É–¥–µ–º –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∫–∞–∫ –µ—Å–ª–∏ –±—ã –Ω–∞–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.

–í SQL –ø–∏—à–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä:
- ${run_date} ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è DBeaver (SQL Variables)
- —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY-MM-DD

#### –î–ª—è —Ö–∞–±–æ–≤

```sql
INSERT INTO memory.dds.hub_order
SELECT DISTINCT
  md5(to_utf8(upper(trim(cast(o.orderkey as varchar)))))       AS order_hk,
  upper(trim(cast(o.orderkey as varchar)))                     AS order_bk,
  current_timestamp                                            AS navi_date,
  'tpch.tiny.orders'                                           AS record_source
FROM tpch.tiny.orders o
WHERE o.orderdate = DATE '${run_date}';
```
–ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/27.png)

–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—à–ª–∞ –ª–∏ –∑–∞–ø–∏—Å—å
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/28.png)

#### –î–ª—è link
```sql
INSERT INTO memory.dds.lnk_order_customer
SELECT
  md5(to_utf8(upper(trim(concat_ws('|',
      cast(o.orderkey as varchar),
      cast(o.custkey as varchar)
  )))))                                                        AS lnk_hk,
  md5(to_utf8(upper(trim(cast(o.orderkey as varchar)))))       AS order_hk,
  md5(to_utf8(upper(trim(cast(o.custkey as varchar)))))        AS customer_hk,
  current_timestamp                                            AS navi_date,
  'tpch.tiny.orders'                                           AS record_source
FROM tpch.tiny.orders o
WHERE o.orderdate = DATE '${run_date}';
```

–ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/29.png)

–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—à–ª–∞ –ª–∏ –∑–∞–ø–∏—Å—å
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/30.png)

#### –î–ª—è —Å–∞—Ç—Ç–µ–ª–∏—Ç–∞

–¢—É—Ç —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ. 
memory –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä Trino –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç UPDATE/DELETE ‚Üí ‚Äú–Ω–∞—Å—Ç–æ—è—â–∏–π‚Äù SCD2 —á–µ—Ä–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–æ–∫ –≤ —ç—Ç–æ–π —Å—Ä–µ–¥–µ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è

–í –∏–¥–µ–∞–ª–µ —è –±—ã —Å–¥–µ–ª–∞–ª —Ç–∞–∫. –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–ª —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
```sql
UPDATE memory.dds.sat_order_attr
SET
  end_date   = date_add('day', -1, DATE '${run_date}'),
  is_current = false,
  navi_date  = current_timestamp
WHERE is_current = true
  AND EXISTS (
    SELECT 1
    FROM tpch.tiny.orders o
    WHERE o.orderdate = DATE '${run_date}'
      AND order_hk = md5(to_utf8(upper(trim(cast(o.orderkey as varchar)))))
      AND hashdiff <> md5(to_utf8(upper(trim(concat_ws('|',
            coalesce(o.orderstatus,''),
            cast(coalesce(o.totalprice, 0.0) as varchar),
            cast(o.orderdate as varchar),
            coalesce(o.orderpriority,''),
            coalesce(o.clerk,''),
            cast(coalesce(o.shippriority, 0) as varchar),
            coalesce(o.comment,'')
      )))))
  );
```
–ü–æ—Ç–æ–º –≤—Å—Ç–∞–≤–∏–ª –±—ã –Ω–æ–≤—ã–µ

```sql
INSERT INTO memory.dds.sat_order_attr
SELECT
  md5(to_utf8(upper(trim(cast(o.orderkey as varchar))))) AS order_hk,
  o.orderstatus, o.totalprice, o.orderdate, o.orderpriority, o.clerk, o.shippriority, o.comment,
  md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(o.orderstatus,''),
      cast(coalesce(o.totalprice, 0.0) as varchar),
      cast(o.orderdate as varchar),
      coalesce(o.orderpriority,''),
      coalesce(o.clerk,''),
      cast(coalesce(o.shippriority, 0) as varchar),
      coalesce(o.comment,'')
  ))))) AS hashdiff,
  DATE '${run_date}' AS start_date,
  DATE '9999-12-31' AS end_date,
  true AS is_current,
  current_timestamp AS navi_date,
  'tpch.tiny.orders' AS record_source
FROM tpch.tiny.orders o
WHERE o.orderdate = DATE '${run_date}'
  AND NOT EXISTS (
    SELECT 1
    FROM memory.dds.sat_order_attr cur
    WHERE cur.order_hk = md5(to_utf8(upper(trim(cast(o.orderkey as varchar)))))
      AND cur.is_current = true
      AND cur.hashdiff = md5(to_utf8(upper(trim(concat_ws('|',
          coalesce(o.orderstatus,''),
          cast(coalesce(o.totalprice, 0.0) as varchar),
          cast(o.orderdate as varchar),
          coalesce(o.orderpriority,''),
          coalesce(o.clerk,''),
          cast(coalesce(o.shippriority, 0) as varchar),
          coalesce(o.comment,'')
      )))))
  );
```

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é —Ç–∞–∫ –ª–∞–∫–æ–Ω–∏—á–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –ø–æ–ª—É—á–∏—Ç—å—Å—è, –Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø scd2 –º–æ–∂–Ω–æ –¥—Ä—É–≥–∏–º –ø—É—Ç—ë–º

–õ–æ–≥–∏–∫–∞:
1. –ë–µ—Ä—ë–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ SAT.
2. –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ current –∏ –ø–æ —ç—Ç–æ–º—É order_hk –ø—Ä–∏—à–ª–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –¥—Ä—É–≥–∏–º hashdiff => ‚Äú–∑–∞–∫—Ä—ã–≤–∞–µ–º‚Äù –µ—ë (end_date = run_date-1, is_current=false).
3. –î–æ–±–∞–≤–ª—è–µ–º ‚Äú–Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏‚Äù –¥–ª—è:
- –Ω–æ–≤—ã—Ö order_hk (–Ω–µ –±—ã–ª–æ current)
- –∏–ª–∏ –∏–∑–º–µ–Ω–∏–≤—à–∏—Ö—Å—è (hashdiff –¥—Ä—É–≥–æ–π)

```sql
DROP TABLE IF EXISTS memory.dds.sat_order_attr_new;

CREATE TABLE memory.dds.sat_order_attr_new AS
WITH src AS (
  SELECT
    md5(to_utf8(upper(trim(cast(o.orderkey as varchar))))) AS order_hk,
    o.orderstatus, o.totalprice, o.orderdate, o.orderpriority, o.clerk, o.shippriority, o.comment,
    md5(to_utf8(upper(trim(concat_ws('|',
      coalesce(o.orderstatus,''),
      cast(coalesce(o.totalprice, 0.0) as varchar),
      cast(o.orderdate as varchar),
      coalesce(o.orderpriority,''),
      coalesce(o.clerk,''),
      cast(coalesce(o.shippriority, 0) as varchar),
      coalesce(o.comment,'')
    ))))) AS hashdiff
  FROM tpch.tiny.orders o
  WHERE o.orderdate = DATE '1996-01-01'
),
closed_old AS (
  SELECT
    t.order_hk,
    t.o_orderstatus, t.o_totalprice, t.o_orderdate, t.o_orderpriority, t.o_clerk, t.o_shippriority, t.o_comment,
    t.hashdiff,
    t.start_date,
    CASE
      WHEN t.is_current = true
           AND s.order_hk IS NOT NULL
           AND t.hashdiff <> s.hashdiff
      THEN date_add('day', -1, DATE '1996-01-01')
      ELSE t.end_date
    END AS end_date,
    CASE
      WHEN t.is_current = true
           AND s.order_hk IS NOT NULL
           AND t.hashdiff <> s.hashdiff
      THEN false
      ELSE t.is_current
    END AS is_current,
    current_timestamp AS navi_date,
    t.record_source
  FROM memory.dds.sat_order_attr t
  LEFT JOIN src s
    ON s.order_hk = t.order_hk
),
new_versions AS (
  SELECT
    s.order_hk,
    s.orderstatus AS o_orderstatus,
    s.totalprice  AS o_totalprice,
    s.orderdate   AS o_orderdate,
    s.orderpriority AS o_orderpriority,
    s.clerk       AS o_clerk,
    s.shippriority AS o_shippriority,
    s.comment     AS o_comment,
    s.hashdiff,
    DATE '1996-01-01' AS start_date,
    DATE '9999-12-31' AS end_date,
    true AS is_current,
    current_timestamp AS navi_date,
    'tpch.tiny.orders' AS record_source
  FROM src s
  LEFT JOIN memory.dds.sat_order_attr cur
    ON cur.order_hk = s.order_hk AND cur.is_current = true
  WHERE cur.order_hk IS NULL OR cur.hashdiff <> s.hashdiff
)
SELECT * FROM closed_old
UNION ALL
SELECT * FROM new_versions;
```

![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/31.png)


–ò —Ç–µ–ø–µ—Ä—å –∑–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—É—é –Ω–∞ –Ω–æ–≤—É—é
```sql
DROP TABLE memory.dds.sat_order_attr;
ALTER TABLE memory.dds.sat_order_attr_new RENAME TO sat_order_attr;
```
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/32.png)


–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, TPC-H ‚Äî —Å—Ç–∞—Ç–∏—á–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–µ –º–æ–¥–µ–ª–∏—Ä—É—é—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–≥–æ–Ω–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —É –∫–æ—Ç–æ—Ä—ã—Ö end_date –±–æ—å—à–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
![–°–∫—Ä–∏–Ω—à–æ—Ç](screenshots/33.png)
